2025-02-06 18:54:46,248 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' 1: 3 r'}
2025-02-06 18:54:46,363 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': 'eps x 100kg\n   - Set '}
2025-02-06 18:54:46,465 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': '2: 5 reps x'}
2025-02-06 18:54:46,568 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' 100kg  \n   - Set'}
2025-02-06 18:54:46,674 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' 3: 3 reps'}
2025-02-06 18:54:46,758 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' x 105kg\n\n2.'}
2025-02-06 18:54:46,861 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' Dips \n   - Set'}
2025-02-06 18:54:46,964 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' 1: 12 reps'}
2025-02-06 18:54:47,104 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' x BW+'}
2025-02-06 18:54:47,210 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': '10kg\n   - Set 2'}
2025-02-06 18:54:47,298 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ': 12 reps x B'}
2025-02-06 18:54:47,441 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': 'W+10kg\n   - Set'}
2025-02-06 18:54:47,541 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' 3: 12 reps'}
2025-02-06 18:54:47,634 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' x BW+10kg'}
2025-02-06 18:54:47,838 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': '\n     \n3. Preacher Curl\n   '}
2025-02-06 18:54:47,935 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': '- Set 1: '}
2025-02-06 18:54:48,031 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': '8 reps x'}
2025-02-06 18:54:48,134 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' 40kg\n   - Set '}
2025-02-06 18:54:48,226 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': '2: 8 reps x'}
2025-02-06 18:54:48,333 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' 40kg\n   - Set '}
2025-02-06 18:54:48,433 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': '3: 8 reps x'}
2025-02-06 18:54:48,550 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' 40kg\n\nDoes'}
2025-02-06 18:54:48,633 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ' this look correct?'}
2025-02-06 18:54:48,645 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'content', 'data': ''}
2025-02-06 18:54:49,000 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-02-06 18:54:49,002 - httpcore.http11 - DEBUG - response_closed.started
2025-02-06 18:54:49,003 - httpcore.http11 - DEBUG - response_closed.complete
2025-02-06 18:54:49,005 - app.services.chains.workout_chain - DEBUG - Response generated: Let me summarize your workout:

• Chest Day
Exercises:
1. Bench Press
   - Set 1: 3 reps x 100kg
   ...
2025-02-06 18:54:49,005 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'done'}
2025-02-06 18:54:53,886 - app.services.conversation_service - DEBUG - Processing message: Yes...
2025-02-06 18:54:53,887 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'loading_start', 'data': None}
2025-02-06 18:54:53,888 - app.services.chains.workout_chain - DEBUG - Processing message (attempt 1): Yes...
2025-02-06 18:54:53,888 - app.services.chains.workout_chain - DEBUG - Analyzing sentiment for presented summary...
2025-02-06 18:54:53,898 - anthropic._base_client - DEBUG - Request options: {'method': 'post', 'url': '/v1/messages', 'files': None, 'json_data': {'max_tokens': 1024, 'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': "Last AI Message: Let me summarize your workout:\n\n• Chest Day\nExercises:\n1. Bench Press\n   - Set 1: 3 reps x 100kg\n   - Set 2: 5 reps x 100kg  \n   - Set 3: 3 reps x 105kg\n\n2. Dips \n   - Set 1: 12 reps x BW+10kg\n   - Set 2: 12 reps x BW+10kg\n   - Set 3: 12 reps x BW+10kg\n     \n3. Preacher Curl\n   - Set 1: 8 reps x 40kg\n   - Set 2: 8 reps x 40kg\n   - Set 3: 8 reps x 40kg\n\nDoes this look correct?\nUser Response: Yes\n\nOnly return APPROVE if both:\n1. The AI's last message contains a workout summary\n2. The user's response indicates approval"}, {'type': 'text', 'text': '{current_message}'}]}], 'model': 'claude-3-sonnet-20240229', 'stream': True, 'system': "Analyze if the user's response fully approves the summary or requests any changes.\nRules:\n- Return 'APPROVE' only if the response indicates complete acceptance\n- Return 'REJECT' if:\n  * Any changes are requested, even minor ones\n  * User seems unsure or asks questions\n  * User indicates any information is incorrect or missing\n  * User wants to add or modify any details"}}
2025-02-06 18:54:53,900 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-02-06 18:54:53,901 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-02-06 18:54:53,902 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-02-06 18:54:53,902 - httpcore.http11 - DEBUG - send_request_body.complete
2025-02-06 18:54:53,902 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-02-06 18:54:55,587 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Thu, 06 Feb 2025 18:54:55 GMT'), (b'Content-Type', b'text/event-stream; charset=utf-8'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'Cache-Control', b'no-cache'), (b'anthropic-ratelimit-requests-limit', b'50'), (b'anthropic-ratelimit-requests-remaining', b'49'), (b'anthropic-ratelimit-requests-reset', b'2025-02-06T18:54:55Z'), (b'anthropic-ratelimit-input-tokens-limit', b'40000'), (b'anthropic-ratelimit-input-tokens-remaining', b'40000'), (b'anthropic-ratelimit-input-tokens-reset', b'2025-02-06T18:54:54Z'), (b'anthropic-ratelimit-output-tokens-limit', b'8000'), (b'anthropic-ratelimit-output-tokens-remaining', b'7000'), (b'anthropic-ratelimit-output-tokens-reset', b'2025-02-06T18:54:58Z'), (b'anthropic-ratelimit-tokens-limit', b'48000'), (b'anthropic-ratelimit-tokens-remaining', b'47000'), (b'anthropic-ratelimit-tokens-reset', b'2025-02-06T18:54:54Z'), (b'request-id', b'req_01S3Uf8cQKkwwWAFTS2iAdie'), (b'via', b'1.1 google'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'90dd59f3eba00765-MAN')])
2025-02-06 18:54:55,590 - httpx - INFO - HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
2025-02-06 18:54:55,591 - anthropic._base_client - DEBUG - HTTP Request: POST https://api.anthropic.com/v1/messages "200 OK"
2025-02-06 18:54:55,591 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-02-06 18:54:55,654 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-02-06 18:54:55,655 - httpcore.http11 - DEBUG - response_closed.started
2025-02-06 18:54:55,656 - httpcore.http11 - DEBUG - response_closed.complete
2025-02-06 18:54:55,659 - app.services.chains.workout_chain - DEBUG - Summary approved by user
2025-02-06 18:54:55,659 - app.services.conversation_service - DEBUG - Sent chunk: {'type': 'workout_approved', 'data': {'name': 'Chest Day', 'description': None, 'exercises': [{'exercise_name': 'Bench Press', 'set_data': {'sets': [{'weight': 100, 'reps': 3}, {'weight': 100, 'reps': 5}, {'weight': 105, 'reps': 3}]}, 'order_in_workout': 1, 'weight_unit': 'kg', 'distance_unit': None}, {'exercise_name': 'Dips', 'set_data': {'sets': [{'weight': 10, 'reps': 12}, {'weight': 10, 'reps': 12}, {'weight': 10, 'reps': 12}]}, 'order_in_workout': 2, 'weight_unit': 'kg', 'distance_unit': None}]}}
2025-02-06 20:44:58,956 - app.services.conversation_service - ERROR - WebSocket disconnected with code 1006 and reason: 
2025-02-06 20:44:59,092 - app.api.endpoints.llm - ERROR - WebSocket disconnected with code 1006 and reason: 
