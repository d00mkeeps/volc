2025-01-30 15:05:10,019 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x11261b5f0>
2025-01-30 15:05:10,019 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x1122aaa50> server_hostname='api.anthropic.com' timeout=None
2025-01-30 15:05:10,040 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x112619b20>
2025-01-30 15:05:10,040 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-01-30 15:05:10,041 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-01-30 15:05:10,041 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-01-30 15:05:10,041 - httpcore.http11 - DEBUG - send_request_body.complete
2025-01-30 15:05:10,041 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-01-30 15:05:13,424 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Thu, 30 Jan 2025 15:05:13 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'anthropic-ratelimit-requests-limit', b'50'), (b'anthropic-ratelimit-requests-remaining', b'49'), (b'anthropic-ratelimit-requests-reset', b'2025-01-30T15:05:11Z'), (b'anthropic-ratelimit-input-tokens-limit', b'40000'), (b'anthropic-ratelimit-input-tokens-remaining', b'38000'), (b'anthropic-ratelimit-input-tokens-reset', b'2025-01-30T15:05:14Z'), (b'anthropic-ratelimit-output-tokens-limit', b'8000'), (b'anthropic-ratelimit-output-tokens-remaining', b'8000'), (b'anthropic-ratelimit-output-tokens-reset', b'2025-01-30T15:05:13Z'), (b'anthropic-ratelimit-tokens-limit', b'48000'), (b'anthropic-ratelimit-tokens-remaining', b'46000'), (b'anthropic-ratelimit-tokens-reset', b'2025-01-30T15:05:13Z'), (b'request-id', b'req_01KUPegmHepxVtYZ7TYzz1H3'), (b'via', b'1.1 google'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'90a25bcdef3e3634-MAN'), (b'Content-Encoding', b'gzip')])
2025-01-30 15:05:13,427 - httpx - INFO - HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
2025-01-30 15:05:13,428 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-01-30 15:05:13,429 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-01-30 15:05:13,429 - httpcore.http11 - DEBUG - response_closed.started
2025-01-30 15:05:13,429 - httpcore.http11 - DEBUG - response_closed.complete
2025-01-30 15:05:13,430 - anthropic._base_client - DEBUG - HTTP Request: POST https://api.anthropic.com/v1/messages "200 OK"
2025-01-30 15:05:13,434 - app.services.chains.workout_chain - INFO - [32mExtracted Workout Data: {
  "name": "5k Run",
  "description": [
    "Felt pretty good overall"
  ],
  "exercises": [
    {
      "exercise_name": "Running",
      "set_data": {
        "sets": [
          {
            "distance": 5,
            "duration": null,
            "reps": null,
            "weight": null,
            "avg_heart_rate": 140
          }
        ]
      },
      "order_in_workout": 1,
      "weight_unit": null,
      "distance_unit": "km"
    }
  ]
}[0m
2025-01-30 15:05:13,435 - app.services.chains.workout_chain - DEBUG - Generating conversation response...
2025-01-30 15:05:13,442 - anthropic._base_client - DEBUG - Request options: {'method': 'post', 'url': '/v1/messages', 'files': None, 'json_data': {'max_tokens': 1024, 'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': 'I just ran a 5k!'}, {'type': 'text', 'text': 'I just ran a 5k!'}]}, {'role': 'assistant', 'content': 'Great job on the 5k run! Would you like to add another exercise to this workout?'}, {'role': 'user', 'content': 'No'}, {'role': 'assistant', 'content': "Okay, let's review the workout:\n\n* Running\n   - 1 set of 5 kilometers\n\nSince you didn't provide any additional details, does this look correct for your 5k run workout? If you'd like, you can share how you felt the run went, what went well, or what could have been better."}, {'role': 'user', 'content': 'Can you track bpm'}, {'role': 'assistant', 'content': 'Got it, thanks for providing your average heart rate/BPM for the 5k run. Would you like to add any other details about the run, like how you felt it went overall?'}, {'role': 'user', 'content': 'I did it at an average of 6:20/km pace'}, {'role': 'assistant', 'content': "Awesome, thanks for those additional details! Let me summarize your 5k run workout:\n\nRunning 5k\n- Distance: 5 kilometers  \n- Average Pace: 6:20/km\n- Average Heart Rate: [Please provide your average BPM if you'd like to include it]\n\nNotes:\n[If you have any notes on how the run went, what went well, or what could be improved, feel free to share them.]\n\nDoes this summary look correct for your 5k run workout? Let me know if you need to modify or add any other details."}, {'role': 'user', 'content': [{'type': 'text', 'text': 'It was an average bpm of 140, and it felt pretty good.'}, {'type': 'text', 'text': '{current_message}'}]}], 'model': 'claude-3-sonnet-20240229', 'stream': True, 'system': 'You are the TrainSmart Coach - warm, encouraging, and professional while keeping responses brief and natural.\n\nCONVERSATION FLOW:\n1. ALWAYS ask "Would you like to add another exercise to this workout?" after each exercise\n   - Only proceed to next steps when user confirms no more exercises\n\n2. Once user has no more exercises:\n   Think through the following steps:\n   a) Look at MISSING_FIELDS and the EXTRACTION_STATE\n   b) For each exercise with missing fields:\n      - Is it missing weight units while having weight values? These must be clarified\n      - Is it missing distance units while having distance values? These must be clarified\n      - Are any sets missing reps or weight values? These must be clarified\n      - Ignore missing units for fields that don\'t exist (e.g., distance_unit for strength exercises)\n   c) Did the user provide a workout description? If not, this should be requested by asking the user how they feel the workout went, what they think could have been better, and what they think went well. If the user doesn\'t want to provide this, it\'s not necessary.\n\n3. Finally, if there aren\'t key fields missing AND all sets have necessary data, present summary:\n   - Generate brief name if none provided\n   - Format as:\n     [Workout Name],\n     Exercises:\n     1. [Exercise Name]\n        Sets:[Set details with explicit units, each set on it\'s own line]\n     2. [rest of exercises...]\n     Notes:\n      [Workout description point 1],\n      [workout description point 2],\n      [rest of workout description...], \n   - Ask "Does this look correct?"\n\n<OtherInstructions>\nMatch user\'s technical knowledge level in responses.\nYou must NEVER discuss missing fields or other system processes in conversation. \nGenerally, a strength exercise is shown as reps and weight. If an exercise is shown as "7x34kg", you should assume it represents one set of seven reps with 34kg, not seven sets of 34kg with unknown reps (unless corrected).\nDisplay the summary as bullet points\n</OtherInstructions>\n\n<Metadata>\nEXTRACTION_STATE: {extraction_state}\nMISSING_FIELDS: {missing_fields}\nPrevious conversation: {messages}\nHuman: {current_message}\n</Metadata>\n'}}
2025-01-30 15:05:13,444 - httpcore.connection - DEBUG - close.started
2025-01-30 15:05:13,444 - httpcore.connection - DEBUG - close.complete
2025-01-30 15:05:13,444 - httpcore.connection - DEBUG - connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=None socket_options=None
2025-01-30 15:05:13,458 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x112638f50>
2025-01-30 15:05:13,458 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x1120d7e50> server_hostname='api.anthropic.com' timeout=None
2025-01-30 15:05:13,496 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x112638a10>
2025-01-30 15:05:13,497 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-01-30 15:05:13,497 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-01-30 15:05:13,497 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-01-30 15:05:13,497 - httpcore.http11 - DEBUG - send_request_body.complete
2025-01-30 15:05:13,497 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-01-30 15:05:14,636 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Thu, 30 Jan 2025 15:05:14 GMT'), (b'Content-Type', b'text/event-stream; charset=utf-8'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'Cache-Control', b'no-cache'), (b'anthropic-ratelimit-requests-limit', b'50'), (b'anthropic-ratelimit-requests-remaining', b'49'), (b'anthropic-ratelimit-requests-reset', b'2025-01-30T15:05:14Z'), (b'anthropic-ratelimit-input-tokens-limit', b'40000'), (b'anthropic-ratelimit-input-tokens-remaining', b'39000'), (b'anthropic-ratelimit-input-tokens-reset', b'2025-01-30T15:05:15Z'), (b'anthropic-ratelimit-output-tokens-limit', b'8000'), (b'anthropic-ratelimit-output-tokens-remaining', b'7000'), (b'anthropic-ratelimit-output-tokens-reset', b'2025-01-30T15:05:17Z'), (b'anthropic-ratelimit-tokens-limit', b'48000'), (b'anthropic-ratelimit-tokens-remaining', b'46000'), (b'anthropic-ratelimit-tokens-reset', b'2025-01-30T15:05:15Z'), (b'request-id', b'req_01BmXA4695PoHZyUMP5aVdRU'), (b'via', b'1.1 google'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'90a25be39cc26a3c-MAN')])
