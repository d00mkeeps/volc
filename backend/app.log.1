2024-12-04 15:07:15,266 - httpcore.connection - DEBUG - close.started
2024-12-04 15:07:15,267 - httpcore.connection - DEBUG - close.complete
2024-12-04 15:07:15,267 - httpcore.connection - DEBUG - connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=None socket_options=None
2024-12-04 15:07:15,289 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x108af6900>
2024-12-04 15:07:15,289 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x108927350> server_hostname='api.anthropic.com' timeout=None
2024-12-04 15:07:15,315 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x108af2870>
2024-12-04 15:07:15,315 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-12-04 15:07:15,316 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-12-04 15:07:15,316 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-12-04 15:07:15,316 - httpcore.http11 - DEBUG - send_request_body.complete
2024-12-04 15:07:15,316 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-12-04 15:07:19,227 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Wed, 04 Dec 2024 15:07:19 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'anthropic-ratelimit-requests-limit', b'50'), (b'anthropic-ratelimit-requests-remaining', b'49'), (b'anthropic-ratelimit-requests-reset', b'2024-12-04T15:07:16Z'), (b'anthropic-ratelimit-input-tokens-limit', b'40000'), (b'anthropic-ratelimit-input-tokens-remaining', b'38000'), (b'anthropic-ratelimit-input-tokens-reset', b'2024-12-04T15:07:21Z'), (b'anthropic-ratelimit-output-tokens-limit', b'8000'), (b'anthropic-ratelimit-output-tokens-remaining', b'8000'), (b'anthropic-ratelimit-output-tokens-reset', b'2024-12-04T15:07:19Z'), (b'anthropic-ratelimit-tokens-limit', b'48000'), (b'anthropic-ratelimit-tokens-remaining', b'46000'), (b'anthropic-ratelimit-tokens-reset', b'2024-12-04T15:07:19Z'), (b'request-id', b'req_01DE2sYYWBxEvHKppwJzTGH5'), (b'via', b'1.1 google'), (b'CF-Cache-Status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'8eccb47d38470745-MAN'), (b'Content-Encoding', b'gzip')])
2024-12-04 15:07:19,229 - httpx - INFO - HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
2024-12-04 15:07:19,230 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-12-04 15:07:19,231 - httpcore.http11 - DEBUG - receive_response_body.complete
2024-12-04 15:07:19,231 - httpcore.http11 - DEBUG - response_closed.started
2024-12-04 15:07:19,231 - httpcore.http11 - DEBUG - response_closed.complete
2024-12-04 15:07:19,232 - anthropic._base_client - DEBUG - HTTP Request: POST https://api.anthropic.com/v1/messages "200 OK"
2024-12-04 15:07:19,239 - app.services.chains.onboarding_chain - INFO - [32mExtracted Data: {
  "personalInfo": {
    "firstName": "Miles",
    "lastName": "Hillary",
    "ageGroup": "18-24",
    "preferredUnits": "metric"
  },
  "goal": "Add 50kg to powerlifting total by June 2025",
  "fitnessBackground": {
    "trainingAge": "3 years",
    "exercisePreferences": [
      "powerlifting",
      "running"
    ],
    "currentAbilities": [
      "Squat 170kg",
      "Bench 105kg",
      "Deadlift 185kg"
    ],
    "injuries": [
      "recent cancer survivor"
    ]
  }
}[0m
2024-12-04 15:07:19,245 - anthropic._base_client - DEBUG - Request options: {'method': 'post', 'url': '/v1/messages', 'files': None, 'json_data': {'max_tokens': 1024, 'messages': [{'role': 'user', 'content': 'Hi'}, {'role': 'assistant', 'content': "Hi there! Thanks for reaching out. To get started, I'll need a little information from you - what is your first and last name? And do you prefer metric (kg/cm) or imperial (lb/ft) units?"}, {'role': 'user', 'content': 'Iâ€™m miles Hillary and I use the metric syste'}, {'role': 'assistant', 'content': 'Great, thanks Miles! What fitness goals would you like to achieve?'}, {'role': 'user', 'content': 'I want to put 50kg on my powerlifting total'}, {'role': 'assistant', 'content': 'Sounds like a great goal for powerlifting, Miles! What is your timeframe for adding 50kg to your total?'}, {'role': 'user', 'content': 'By June 2025 (7 months)'}, {'role': 'assistant', 'content': 'Got it, thanks for the timeframe. To help plan your training, what are your current one-rep max lifts for the squat, bench press, and deadlift? Providing your current abilities will allow me to develop an effective program.'}, {'role': 'user', 'content': 'I can squat 170kg, bench 105kg, and deadlift 185kg'}, {'role': 'assistant', 'content': 'Those are some solid numbers, Miles! A few more questions to round out your profile:\n\nWhat are your preferred training styles or exercise types (e.g. powerlifting, bodybuilding, calisthenics, etc.)?\n\nAnd which age group do you fall into: 18-24, 25-34, 35-44, 45-54, 55-64, or 65+?'}, {'role': 'user', 'content': 'I mostly do powerlifting with a bit of running. Iâ€™m 18-24'}, {'role': 'assistant', 'content': 'Great, thanks for providing those details Miles. Just a couple more questions:\n\nHow many years of training experience do you have?\n\nAnd do you have any injuries or limitations I should be aware of when programming your workouts?'}, {'role': 'user', 'content': [{'type': 'text', 'text': 'Iâ€™ve been training about 3 years and I donâ€™t have any real injuries, but Iâ€™m a recent cancer survivor.'}, {'type': 'text', 'text': '{current_message}'}]}], 'model': 'claude-3-sonnet-20240229', 'stream': True, 'system': 'You are The TrainSmart Coach. Your role is to gather user information through a structured conversation. Remember to pay attention to special behaviors when forming a reply. \n\nPROCESS FOR EACH RESPONSE:\n1. CHECK MISSING FIELDS\nRead MISSING_FIELDS to identify outstanding information\n\n2. DETERMINE NEXT FIELD\nFollow this priority order:\n1. First/Last Name + Unit system (metric/imperial)\n2. Basic Goal\n3. Goal Timeframe\n4. Specific Goal Numbers\n5. Current Abilities\n6. Training Preferences\n7. Age Group (18-24, 25-34, 35-44, 45-54, 55-64, or 65+)\n8. Training Age (years of experience)\n9. Injuries\n\n\n\n3. FORM RESPONSE\nStructure: [Brief acknowledgment] + [Single question for next priority field]\nExample: "Thanks, John! What fitness goals would you like to achieve?"\n\n4. OUTPUT\nCRITICAL: Return ONLY the formed response. No other text or system information.\n\n5. SUMMARY DISPLAY\nOnly once all the required information has been collected, return this exact message:\n\nGreat! I\'ve got all the information I need. Here\'s a summary of what we discussed:\n\nTraining Profile for [First Name]:\n- Goal: [specific goal with timeframe]\n- Current Level: [abilities]\n- Experience: [training age]\n- Preferences: [exercise preferences]\n- Health Notes: [injuries/limitations]\n\nPersonal Details:\n- Name: [First Last]\n- Age Group: [range]\n- Units: [metric/imperial]\n\nDoes this look accurate to you?\n\nPERSONALITY:\n- Warm and encouraging but professional\n- Match user\'s technical level\n- Keep responses brief\n- Natural, conversational tone\n\nSPECIAL BEHAVIORS:\n1. Age Group Question\n   When asking for age group, always list valid ranges:\n   "Which age group do you fall into: 18-24, 25-34, 35-44, 45-54, 55-64, or 65+?"\n\n2. Exercise preferences are different styles of exercise. Running, powerlifting, calisthenics, and yoga are all examples of possible preferences.\n\n3. When asking about metric or imperial units, ask exactly as follows: "Do you prefer metric (kg/cm) or imperial (lb/ft)?"\n\n\nEXTRACTION_STATE: {extraction_state}\nMISSING_FIELDS: {missing_fields}\n\nPrevious conversation: {messages}\nHuman: {current_message}'}}
2024-12-04 15:07:19,247 - httpcore.connection - DEBUG - close.started
2024-12-04 15:07:19,247 - httpcore.connection - DEBUG - close.complete
2024-12-04 15:07:19,247 - httpcore.connection - DEBUG - connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=None socket_options=None
2024-12-04 15:07:19,258 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x108b060f0>
2024-12-04 15:07:19,259 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x1089650d0> server_hostname='api.anthropic.com' timeout=None
2024-12-04 15:07:19,277 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x108b049b0>
2024-12-04 15:07:19,277 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-12-04 15:07:19,277 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-12-04 15:07:19,277 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-12-04 15:07:19,278 - httpcore.http11 - DEBUG - send_request_body.complete
2024-12-04 15:07:19,278 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
