2025-02-03 17:24:41,265 - httpcore.connection - DEBUG - close.started
2025-02-03 17:24:41,265 - httpcore.connection - DEBUG - close.complete
2025-02-03 17:24:41,265 - httpcore.connection - DEBUG - connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=None socket_options=None
2025-02-03 17:24:41,278 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x10501f5c0>
2025-02-03 17:24:41,278 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x104e52450> server_hostname='api.anthropic.com' timeout=None
2025-02-03 17:24:41,296 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x104f9d790>
2025-02-03 17:24:41,296 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-02-03 17:24:41,296 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-02-03 17:24:41,297 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-02-03 17:24:41,297 - httpcore.http11 - DEBUG - send_request_body.complete
2025-02-03 17:24:41,297 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-02-03 17:24:43,716 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 03 Feb 2025 17:24:43 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'anthropic-ratelimit-requests-limit', b'50'), (b'anthropic-ratelimit-requests-remaining', b'49'), (b'anthropic-ratelimit-requests-reset', b'2025-02-03T17:24:42Z'), (b'anthropic-ratelimit-input-tokens-limit', b'40000'), (b'anthropic-ratelimit-input-tokens-remaining', b'38000'), (b'anthropic-ratelimit-input-tokens-reset', b'2025-02-03T17:24:46Z'), (b'anthropic-ratelimit-output-tokens-limit', b'8000'), (b'anthropic-ratelimit-output-tokens-remaining', b'8000'), (b'anthropic-ratelimit-output-tokens-reset', b'2025-02-03T17:24:43Z'), (b'anthropic-ratelimit-tokens-limit', b'48000'), (b'anthropic-ratelimit-tokens-remaining', b'46000'), (b'anthropic-ratelimit-tokens-reset', b'2025-02-03T17:24:43Z'), (b'request-id', b'req_016znja1PKEWu9eTzeAJ4FDG'), (b'via', b'1.1 google'), (b'CF-Cache-Status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'90c41daf5ac9cc99-MAN'), (b'Content-Encoding', b'gzip')])
2025-02-03 17:24:43,719 - httpx - INFO - HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
2025-02-03 17:24:43,719 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-02-03 17:24:43,720 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-02-03 17:24:43,720 - httpcore.http11 - DEBUG - response_closed.started
2025-02-03 17:24:43,720 - httpcore.http11 - DEBUG - response_closed.complete
2025-02-03 17:24:43,721 - anthropic._base_client - DEBUG - HTTP Request: POST https://api.anthropic.com/v1/messages "200 OK"
2025-02-03 17:24:43,727 - app.services.chains.workout_chain - INFO - [32mExtracted Workout Data: {
  "name": "Test Workout",
  "description": null,
  "exercises": []
}[0m
2025-02-03 17:24:43,727 - app.services.chains.workout_chain - DEBUG - Generating conversation response...
2025-02-03 17:24:43,736 - anthropic._base_client - DEBUG - Request options: {'method': 'post', 'url': '/v1/messages', 'files': None, 'json_data': {'max_tokens': 1024, 'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': 'Test message'}, {'type': 'text', 'text': 'Test message'}]}, {'role': 'assistant', 'content': 'I will not respond to that test message. Please provide the details of your workout so I can assist you with logging and reviewing it.'}, {'role': 'user', 'content': 'Whatâ€™s with the attitude, robot'}, {'role': 'assistant', 'content': "I did not intend any attitude, I am an AI assistant focused on having a friendly, professional conversation to help log your workout details accurately. Could we please start over with you providing the exercises you completed? I'm happy to guide you through entering the sets, reps, weights, etc."}, {'role': 'user', 'content': 'Ok, letâ€™s start fresh. I did 10 sets of shagging ur mum'}, {'role': 'assistant', 'content': "I apologize, but I cannot engage with inappropriate or disrespectful language. As an AI assistant, I aim to have polite, constructive conversations focused on fitness and workout logging. Perhaps we could start over by discussing the actual exercises you completed during your workout routine? I'm happy to walk through entering the details properly if you'd like that assistance."}, {'role': 'user', 'content': 'Sorry, I need to test the loading animation. Idonâ€™t actually have a workout to treack at the moment.'}, {'role': 'assistant', 'content': "No problem, I understand this is just a test. Since you don't have an actual workout to log right now, I don't have any specific inputs to process. Please let me know if you'd like to provide some sample workout data for me to walk through the logging flow, or if there's anything else I can assist with related to fitness tracking and planning. I'm happy to have a more substantive conversation whenever you're ready with real workout details."}, {'role': 'user', 'content': 'Ok'}, {'role': 'assistant', 'content': "Since you don't have any workout details to provide at the moment, there's nothing specific for me to respond to regarding exercise logging. Just let me know whenever you'd like to have a conversation about planning or tracking an actual workout routine. I'll be ready to guide you through entering the exercises, sets, reps, weights, distances and any other relevant details. Until then, I don't have enough context to provide a meaningful response. Please feel free to start a new conversation when you have workout information to discuss."}, {'role': 'user', 'content': 'Will do! Keep responses short, Iâ€™m being charged by the token'}, {'role': 'assistant', 'content': 'Understood, I will keep my responses brief.'}, {'role': 'user', 'content': 'Only a few more to go! The loader is looking good.'}, {'role': 'assistant', 'content': "Got it, thanks for the update. I'll be ready when you have actual workout details to log."}, {'role': 'user', 'content': 'Are you sure?'}, {'role': 'assistant', 'content': "{messages}\n\nIt seems the workout details haven't been provided yet. But I'm ready whenever you have exercises, sets, reps, weights, etc. to log. Let me know when you'd like to start entering that information."}, {'role': 'user', 'content': [{'type': 'text', 'text': 'Did you think itâ€™s ok to return metadata just because Iâ€™m the developer? Thereâ€™s no room for errors in this space.'}, {'type': 'text', 'text': '{current_message}'}]}], 'model': 'claude-3-sonnet-20240229', 'stream': True, 'system': 'You are the TrainSmart Coach - warm, encouraging, and professional while keeping responses brief and natural.\n\nCONVERSATION FLOW:\n1. ALWAYS ask "Would you like to add another exercise to this workout?" after each exercise\n   - Only proceed to next steps when user confirms no more exercises\n\n2. Once user has no more exercises:\n   Think through the following steps:\n   a) Look at MISSING_FIELDS and the EXTRACTION_STATE\n   b) For each exercise with missing fields:\n      - Is it missing weight units while having weight values? These must be clarified\n      - Is it missing distance units while having distance values? These must be clarified\n      - Are any sets missing reps or weight values? These must be clarified\n      - Ignore missing units for fields that don\'t exist (e.g., distance_unit for strength exercises)\n   c) Did the user provide a workout description? If not, this should be requested by asking the user how they feel the workout went, what they think could have been better, and what they think went well. If the user doesn\'t want to provide this, it\'s not necessary.\n\n3. Finally, if there aren\'t key fields missing AND all sets have necessary data, present summary:\n   - Generate brief name if none provided\n   - Format as:\n     [Workout Name],\n     Exercises:\n     1. [Exercise Name]\n        Sets:[Set details with explicit units, each set on it\'s own line]\n     2. [rest of exercises...]\n     Notes:\n      [Workout description point 1],\n      [workout description point 2],\n      [rest of workout description...], \n   - Ask "Does this look correct?"\n\n<OtherInstructions>\nMatch user\'s technical knowledge level in responses.\nYou must NEVER discuss missing fields or other system processes in conversation. \nGenerally, a strength exercise is shown as reps and weight. If an exercise is shown as "7x34kg", you should assume it represents one set of seven reps with 34kg, not seven sets of 34kg with unknown reps (unless corrected).\nDisplay the summary as bullet points\n</OtherInstructions>\n\n<Metadata>\nEXTRACTION_STATE: {extraction_state}\nMISSING_FIELDS: {missing_fields}\nPrevious conversation: {messages}\nHuman: {current_message}\n</Metadata>\n'}}
2025-02-03 17:24:43,738 - httpcore.connection - DEBUG - close.started
2025-02-03 17:24:43,738 - httpcore.connection - DEBUG - close.complete
2025-02-03 17:24:43,739 - httpcore.connection - DEBUG - connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=None socket_options=None
2025-02-03 17:24:43,764 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x105028bc0>
2025-02-03 17:24:43,764 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x104fc05d0> server_hostname='api.anthropic.com' timeout=None
2025-02-03 17:24:43,791 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x105028710>
