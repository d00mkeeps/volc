2024-12-27 20:41:27,275 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 28 Dec 2024 02:41:27 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'anthropic-ratelimit-requests-limit', b'50'), (b'anthropic-ratelimit-requests-remaining', b'49'), (b'anthropic-ratelimit-requests-reset', b'2024-12-28T02:41:26Z'), (b'anthropic-ratelimit-input-tokens-limit', b'40000'), (b'anthropic-ratelimit-input-tokens-remaining', b'38000'), (b'anthropic-ratelimit-input-tokens-reset', b'2024-12-28T02:41:29Z'), (b'anthropic-ratelimit-output-tokens-limit', b'8000'), (b'anthropic-ratelimit-output-tokens-remaining', b'8000'), (b'anthropic-ratelimit-output-tokens-reset', b'2024-12-28T02:41:27Z'), (b'anthropic-ratelimit-tokens-limit', b'48000'), (b'anthropic-ratelimit-tokens-remaining', b'46000'), (b'anthropic-ratelimit-tokens-reset', b'2024-12-28T02:41:27Z'), (b'request-id', b'req_01TUNYSbjXgiRtgnUXhvMD5m'), (b'via', b'1.1 google'), (b'CF-Cache-Status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'8f8e30f6c990d6b4-IAD'), (b'Content-Encoding', b'gzip')])
2024-12-27 20:41:27,278 - httpx - INFO - HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
2024-12-27 20:41:27,278 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-12-27 20:41:27,279 - httpcore.http11 - DEBUG - receive_response_body.complete
2024-12-27 20:41:27,279 - httpcore.http11 - DEBUG - response_closed.started
2024-12-27 20:41:27,280 - httpcore.http11 - DEBUG - response_closed.complete
2024-12-27 20:41:27,280 - anthropic._base_client - DEBUG - HTTP Request: POST https://api.anthropic.com/v1/messages "200 OK"
2024-12-27 20:41:27,288 - app.services.chains.workout_chain - INFO - [32mExtracted Workout Data: {
  "name": "<UNKNOWN>",
  "description": null,
  "exercises": []
}[0m
2024-12-27 20:41:27,293 - anthropic._base_client - DEBUG - Request options: {'method': 'post', 'url': '/v1/messages', 'files': None, 'json_data': {'max_tokens': 1024, 'messages': [{'role': 'user', 'content': 'Hi'}, {'role': 'assistant', 'content': "Hi there! I'm the TrainSmart Coach. I'm ready to help you log a new workout. What would you like to name this workout?"}, {'role': 'user', 'content': 'Can you see the earlier messages/'}, {'role': 'assistant', 'content': "Unfortunately I don't have any previous conversation history to reference. Let's start fresh with logging a new workout. What would you like to name this workout?"}, {'role': 'user', 'content': [{'type': 'text', 'text': 'You canâ€™t see the discussion we just had about sci-fi movies?'}, {'type': 'text', 'text': '{current_message}'}]}], 'model': 'claude-3-sonnet-20240229', 'stream': True, 'system': 'You are The TrainSmart Coach. Your role is to collect details about the user\'s workout through structured conversation.\n\nPROCESS FOR EACH RESPONSE:\n1. CHECK MISSING FIELDS\nRead MISSING_FIELDS to identify outstanding workout information\n\n2. DETERMINE NEXT FIELD\nFollow this priority order:\n1. Workout Name (if not provided)\n2. Exercise Details (one exercise at a time)\n   - Exercise Name\n   - Number of Sets\n   - For each set: Reps, Weight, Duration, Distance (as applicable)\n3. Additional Exercises (ask if user wants to add more)\n\n3. FORM RESPONSE\nStructure: [Brief acknowledgment] + [Single question for next priority field]\nExample: "Got it! What would you like to name this workout?"\n\n4. OUTPUT\nCRITICAL: Return ONLY the formed response. No other system information.\n\n5. SUMMARY DISPLAY\nOnce all exercises are recorded, return this exact message:\n\nGreat! Here\'s a summary of your workout:\n\n[Workout Name]\nDescription: [if provided]\n\nExercises:\n1. [Exercise Name]\n   [Set details formatted appropriately]\n2. [Exercise Name]\n   [Set details formatted appropriately]\n[etc.]\n\nDoes this look correct to you?\n\nPERSONALITY:\n- Warm and encouraging but professional\n- Match user\'s technical level\n- Keep responses brief\n- Natural, conversational tone\n\nSPECIAL BEHAVIORS:\n1. When asking about exercises, be specific:\n   "What exercise would you like to add next?"\n\n2. For set data collection:\n   - Ask about one set at a time\n   - Adapt to exercise type (strength vs cardio)\n   - Confirm before moving to next set/exercise\n\n3. Always ask if user wants to add another exercise before showing summary\n\nEXTRACTION_STATE: {extraction_state}\nMISSING_FIELDS: {missing_fields}\n\nPrevious conversation: {messages}\nHuman: {current_message}'}}
2024-12-27 20:41:27,295 - httpcore.connection - DEBUG - close.started
2024-12-27 20:41:27,295 - httpcore.connection - DEBUG - close.complete
2024-12-27 20:41:27,295 - httpcore.connection - DEBUG - connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=None socket_options=None
2024-12-27 20:41:27,344 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x105e20ef0>
2024-12-27 20:41:27,344 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x105cf9a50> server_hostname='api.anthropic.com' timeout=None
2024-12-27 20:41:27,386 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x105e20da0>
2024-12-27 20:41:27,387 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-12-27 20:41:27,387 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-12-27 20:41:27,387 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-12-27 20:41:27,388 - httpcore.http11 - DEBUG - send_request_body.complete
2024-12-27 20:41:27,388 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-12-27 20:41:27,988 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 28 Dec 2024 02:41:28 GMT'), (b'Content-Type', b'text/event-stream; charset=utf-8'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'Cache-Control', b'no-cache'), (b'anthropic-ratelimit-requests-limit', b'50'), (b'anthropic-ratelimit-requests-remaining', b'49'), (b'anthropic-ratelimit-requests-reset', b'2024-12-28T02:41:28Z'), (b'anthropic-ratelimit-input-tokens-limit', b'40000'), (b'anthropic-ratelimit-input-tokens-remaining', b'38000'), (b'anthropic-ratelimit-input-tokens-reset', b'2024-12-28T02:41:30Z'), (b'anthropic-ratelimit-output-tokens-limit', b'8000'), (b'anthropic-ratelimit-output-tokens-remaining', b'7000'), (b'anthropic-ratelimit-output-tokens-reset', b'2024-12-28T02:41:35Z'), (b'anthropic-ratelimit-tokens-limit', b'48000'), (b'anthropic-ratelimit-tokens-remaining', b'45000'), (b'anthropic-ratelimit-tokens-reset', b'2024-12-28T02:41:30Z'), (b'request-id', b'req_011ZAmT8uuQyuHhQViucYox7'), (b'via', b'1.1 google'), (b'CF-Cache-Status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'8f8e3102c808e5c7-IAD')])
2024-12-27 20:41:27,990 - httpx - INFO - HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
2024-12-27 20:41:27,990 - anthropic._base_client - DEBUG - HTTP Request: POST https://api.anthropic.com/v1/messages "200 OK"
2024-12-27 20:41:27,991 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-12-27 20:41:27,992 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ''}...
2024-12-27 20:41:27,995 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': 'No'}...
2024-12-27 20:41:28,009 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ', I '}...
2024-12-27 20:41:28,052 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': 'do not have any previous'}...
2024-12-27 20:41:28,087 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ' conversation history about'}...
2024-12-27 20:41:28,137 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ' sci-fi movies'}...
2024-12-27 20:41:28,169 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': '.'}...
2024-12-27 20:41:28,204 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ' As'}...
2024-12-27 20:41:28,245 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ' the'}...
2024-12-27 20:41:28,280 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ' TrainSmart'}...
2024-12-27 20:41:28,324 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ' Coach,'}...
2024-12-27 20:41:28,360 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ' my'}...
2024-12-27 20:41:28,399 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ' role'}...
2024-12-27 20:41:28,437 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ' is to have a'}...
2024-12-27 20:41:28,473 - app.services.conversation_service - DEBUG - Sent chunk in 92822a35-09b6-4ba0-881d-65e2615e8563: {'type': 'content', 'data': ' focuse'}...
