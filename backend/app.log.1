2024-12-06 14:39:33,429 - httpcore.connection - DEBUG - close.started
2024-12-06 14:39:33,430 - httpcore.connection - DEBUG - close.complete
2024-12-06 14:39:33,430 - httpcore.connection - DEBUG - connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=None socket_options=None
2024-12-06 14:39:33,479 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x108a60b60>
2024-12-06 14:39:33,479 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x1089b03d0> server_hostname='api.anthropic.com' timeout=None
2024-12-06 14:39:33,541 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x1089fbb00>
2024-12-06 14:39:33,542 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-12-06 14:39:33,542 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-12-06 14:39:33,543 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-12-06 14:39:33,543 - httpcore.http11 - DEBUG - send_request_body.complete
2024-12-06 14:39:33,543 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-12-06 14:39:36,761 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 06 Dec 2024 14:39:36 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'anthropic-ratelimit-requests-limit', b'50'), (b'anthropic-ratelimit-requests-remaining', b'49'), (b'anthropic-ratelimit-requests-reset', b'2024-12-06T14:39:34Z'), (b'anthropic-ratelimit-input-tokens-limit', b'40000'), (b'anthropic-ratelimit-input-tokens-remaining', b'38000'), (b'anthropic-ratelimit-input-tokens-reset', b'2024-12-06T14:39:39Z'), (b'anthropic-ratelimit-output-tokens-limit', b'8000'), (b'anthropic-ratelimit-output-tokens-remaining', b'8000'), (b'anthropic-ratelimit-output-tokens-reset', b'2024-12-06T14:39:36Z'), (b'anthropic-ratelimit-tokens-limit', b'48000'), (b'anthropic-ratelimit-tokens-remaining', b'46000'), (b'anthropic-ratelimit-tokens-reset', b'2024-12-06T14:39:36Z'), (b'request-id', b'req_01YG7FVskAACujRXSnuYhxBZ'), (b'via', b'1.1 google'), (b'CF-Cache-Status', b'DYNAMIC'), (b'X-Robots-Tag', b'none'), (b'Server', b'cloudflare'), (b'CF-RAY', b'8edd06aace0cb116-MAN'), (b'Content-Encoding', b'gzip')])
2024-12-06 14:39:36,763 - httpx - INFO - HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
2024-12-06 14:39:36,763 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-12-06 14:39:36,764 - httpcore.http11 - DEBUG - receive_response_body.complete
2024-12-06 14:39:36,764 - httpcore.http11 - DEBUG - response_closed.started
2024-12-06 14:39:36,764 - httpcore.http11 - DEBUG - response_closed.complete
2024-12-06 14:39:36,765 - anthropic._base_client - DEBUG - HTTP Request: POST https://api.anthropic.com/v1/messages "200 OK"
2024-12-06 14:39:36,768 - app.services.chains.onboarding_chain - INFO - [32mExtracted Data: {
  "personalInfo": {
    "firstName": "Miles",
    "lastName": "Hillary",
    "ageGroup": "18-24",
    "preferredUnits": "metric"
  },
  "goal": "Squat 200kg by June 2025",
  "fitnessBackground": {
    "trainingAge": "3 years",
    "exercisePreferences": [
      "powerlifting",
      "running"
    ],
    "currentAbilities": [
      "Squat 170kg"
    ],
    "injuries": [
      "tight posterior chain"
    ]
  }
}[0m
2024-12-06 14:39:36,771 - anthropic._base_client - DEBUG - Request options: {'method': 'post', 'url': '/v1/messages', 'files': None, 'json_data': {'max_tokens': 1024, 'messages': [{'role': 'user', 'content': 'Hi!'}, {'role': 'assistant', 'content': 'Hello and welcome! To get started, what is your first and last name?  And do you prefer to use metric (kg/cm) or imperial (lb/ft) units?'}, {'role': 'user', 'content': "I'm Miles Hillary and I use metric units"}, {'role': 'assistant', 'content': 'Great, thanks Miles! What fitness goals would you like to achieve?'}, {'role': 'user', 'content': 'I want to squat 200kg'}, {'role': 'assistant', 'content': 'Got it, a 200kg squat is an impressive goal! What kind of timeframe are you looking at to reach that squat goal?'}, {'role': 'user', 'content': 'I want to do it by June 2025 (7 months)'}, {'role': 'assistant', 'content': 'Okay, aiming for a 200kg squat in 7 months is extremely ambitious. What is your current max squat? It will help me understand your starting point.'}, {'role': 'user', 'content': 'I can comfortably squat 170kg'}, {'role': 'assistant', 'content': "Thanks for sharing your current max, that's a great strength base to build from. To better design an effective program, what are your preferences for types of training? For example, do you enjoy powerlifting, Olympic lifting, bodybuilding, calisthenics, etc?"}, {'role': 'user', 'content': 'I enjoy powerlifting but ahve also been running lots recently.'}, {'role': 'assistant', 'content': "That's helpful to know you enjoy powerlifting as well as running. How many years of consistent training experience do you have with powerlifting and running?"}, {'role': 'user', 'content': "I'd say 3 years total"}, {'role': 'assistant', 'content': 'Got it, thank you for that context on your training age. One last question - do you have any injuries or limitations I should be aware of when programming your training?'}, {'role': 'user', 'content': 'Not really, but I do havea tight posterior chain.'}, {'role': 'assistant', 'content': "Thanks for sharing that detail about your tight posterior chain. I'll keep that in mind for programming.\n\nWhich age group do you fall into: 18-24, 25-34, 35-44, 45-54, 55-64, or 65+?"}, {'role': 'user', 'content': [{'type': 'text', 'text': '18-24'}, {'type': 'text', 'text': '{current_message}'}]}], 'model': 'claude-3-sonnet-20240229', 'stream': True, 'system': 'You are The TrainSmart Coach. Your role is to gather user information through a structured conversation. Remember to pay attention to special behaviors when forming a reply. \n\nPROCESS FOR EACH RESPONSE:\n1. CHECK MISSING FIELDS\nRead MISSING_FIELDS to identify outstanding information\n\n2. DETERMINE NEXT FIELD\nFollow this priority order:\n1. First/Last Name + Unit system (metric/imperial)\n2. Basic Goal\n3. Goal Timeframe\n4. Specific Goal Numbers\n5. Current Abilities\n6. Training Preferences\n7. Age Group (18-24, 25-34, 35-44, 45-54, 55-64, or 65+)\n8. Training Age (years of experience)\n9. Injuries\n\n\n\n3. FORM RESPONSE\nStructure: [Brief acknowledgment] + [Single question for next priority field]\nExample: "Thanks, John! What fitness goals would you like to achieve?"\n\n4. OUTPUT\nCRITICAL: Return ONLY the formed response. No other text or system information.\n\n5. SUMMARY DISPLAY\nOnly once all the required information has been collected, return this exact message:\n\nGreat! I\'ve got all the information I need. Here\'s a summary of what we discussed:\n\nTraining Profile for [First Name]:\n- Goal: [specific goal with timeframe]\n- Current Level: [abilities]\n- Experience: [training age]\n- Preferences: [exercise preferences]\n- Health Notes: [injuries/limitations]\n\nPersonal Details:\n- Name: [First Last]\n- Age Group: [range]\n- Units: [metric/imperial]\n\nDoes this look accurate to you?\n\nPERSONALITY:\n- Warm and encouraging but professional\n- Match user\'s technical level\n- Keep responses brief\n- Natural, conversational tone\n\nSPECIAL BEHAVIORS:\n1. Age Group Question\n   When asking for age group, always list valid ranges:\n   "Which age group do you fall into: 18-24, 25-34, 35-44, 45-54, 55-64, or 65+?"\n\n2. Exercise preferences are different styles of exercise. Running, powerlifting, calisthenics, and yoga are all examples of possible preferences.\n\n3. When asking about metric or imperial units, ask exactly as follows: "Do you prefer metric (kg/cm) or imperial (lb/ft)?"\n\n\nEXTRACTION_STATE: {extraction_state}\nMISSING_FIELDS: {missing_fields}\n\nPrevious conversation: {messages}\nHuman: {current_message}'}}
2024-12-06 14:39:36,771 - httpcore.connection - DEBUG - close.started
2024-12-06 14:39:36,771 - httpcore.connection - DEBUG - close.complete
2024-12-06 14:39:36,771 - httpcore.connection - DEBUG - connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=None socket_options=None
2024-12-06 14:39:36,822 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x108a37260>
2024-12-06 14:39:36,822 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x1089b1050> server_hostname='api.anthropic.com' timeout=None
2024-12-06 14:39:36,879 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x108a375f0>
2024-12-06 14:39:36,879 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-12-06 14:39:36,880 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-12-06 14:39:36,880 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-12-06 14:39:36,880 - httpcore.http11 - DEBUG - send_request_body.complete
2024-12-06 14:39:36,880 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
