2024-12-16 15:24:01,161 - httpx - DEBUG - load_verify_locations cafile='/Users/mileshillary/Desktop/supreme-octo-doodle/.venv/lib/python3.12/site-packages/certifi/cacert.pem'
2024-12-16 15:24:01,190 - app.services.conversation_service - INFO - Started conversation session: 1734362640942
2024-12-16 15:24:01,193 - httpcore.connection - DEBUG - close.started
2024-12-16 15:24:01,194 - httpcore.connection - DEBUG - close.started
2024-12-16 15:24:01,194 - httpcore.connection - DEBUG - close.started
2024-12-16 15:24:01,198 - httpcore.connection - DEBUG - close.started
2024-12-16 15:24:01,198 - httpcore.connection - DEBUG - close.started
2024-12-16 15:24:01,198 - httpcore.connection - DEBUG - close.complete
2024-12-16 15:24:01,199 - httpcore.connection - DEBUG - close.complete
2024-12-16 15:24:01,201 - httpcore.connection - DEBUG - close.complete
2024-12-16 15:24:01,202 - httpcore.connection - DEBUG - close.complete
2024-12-16 15:24:01,203 - httpcore.connection - DEBUG - close.complete
2024-12-16 15:24:01,239 - anthropic._base_client - DEBUG - Request options: {'method': 'post', 'url': '/v1/messages', 'files': None, 'json_data': {'max_tokens': 1024, 'messages': [{'role': 'user', 'content': 'User: I want to log my chest workout\nAssistant: What would you like to name this workout?\nUser: Monday Chest Day\nAssistant: Great name! What was your first exercise?\nUser: Started with bench press, did 3 sets of 225lbs for 8 reps'}, {'role': 'assistant', 'content': [{'type': 'tool_use', 'name': 'Workout', 'input': {'name': 'Monday Chest Day', 'description': None, 'exercises': [{'exercise_name': 'Bench Press', 'set_data': {'sets': [{'weight': 225, 'reps': 8}, {'weight': 225, 'reps': 8}, {'weight': 225, 'reps': 8}]}, 'order_in_workout': 1}]}, 'id': 'bbf379a7-38fc-4efd-bb39-8f94b5747e0e'}]}, {'role': 'user', 'content': [{'type': 'tool_result', 'content': 'You have correctly called this tool.', 'tool_use_id': 'bbf379a7-38fc-4efd-bb39-8f94b5747e0e', 'is_error': False}, {'type': 'text', 'text': 'User: Log my leg day\nAssistant: What would you like to name this workout?\nUser: Squat Focus Day\nAssistant: Got it! What was your first exercise?\nUser: Squats - first set 135lbs for 10, then 185 for 8, finally 225 for 6\nAssistant: Noted! Any other exercises?\nUser: Yes, did some walking lunges, 3 sets of 40 meters with 20lb dumbbells'}]}, {'role': 'assistant', 'content': [{'type': 'tool_use', 'name': 'Workout', 'input': {'name': 'Squat Focus Day', 'description': None, 'exercises': [{'exercise_name': 'Squats', 'set_data': {'sets': [{'weight': 135, 'reps': 10}, {'weight': 185, 'reps': 8}, {'weight': 225, 'reps': 6}]}, 'order_in_workout': 1}, {'exercise_name': 'Walking Lunges', 'set_data': {'sets': [{'weight': 20, 'distance': '40m'}, {'weight': 20, 'distance': '40m'}, {'weight': 20, 'distance': '40m'}]}, 'order_in_workout': 2}]}, 'id': '7d9d878b-9e16-42d6-9324-92d8cd2c3619'}]}, {'role': 'user', 'content': [{'type': 'tool_result', 'content': 'You have correctly called this tool.', 'tool_use_id': '7d9d878b-9e16-42d6-9324-92d8cd2c3619', 'is_error': False}, {'type': 'text', 'text': 'User: Logging my morning run\nAssistant: What would you like to name this workout?\nUser: Morning 5K\nAssistant: Great! What details can you share about your run?\nUser: Did a 5K in 27:30, started slow and picked up the pace'}]}, {'role': 'assistant', 'content': [{'type': 'tool_use', 'name': 'Workout', 'input': {'name': 'Morning 5K', 'description': None, 'exercises': [{'exercise_name': 'Running', 'set_data': {'sets': [{'duration': '27:30', 'distance': '5km'}]}, 'order_in_workout': 1}]}, 'id': '400adf24-938c-472d-a04f-6eaf62ab91d3'}]}, {'role': 'user', 'content': [{'type': 'tool_result', 'content': 'You have correctly called this tool.', 'tool_use_id': '400adf24-938c-472d-a04f-6eaf62ab91d3', 'is_error': False}, {'type': 'text', 'text': "User: Need to log my HIIT session\nAssistant: What would you like to name this workout?\nUser: Thursday HIIT\nAssistant: Could you provide any additional details about this workout?\nUser: It's a cardio focus day with some strength elements\nAssistant: What was your first exercise?\nUser: Started with assault bike sprints, 30 seconds max effort followed by 30 seconds rest, did that 5 times\nAssistant: Got it! Any other exercises?\nUser: Then did kettlebell swings, 3 sets of 20 reps with 24kg"}]}, {'role': 'assistant', 'content': [{'type': 'tool_use', 'name': 'Workout', 'input': {'name': 'Thursday HIIT', 'description': 'Cardio focus day with some strength elements', 'exercises': [{'exercise_name': 'Assault Bike Sprints', 'set_data': {'sets': [{'duration': '00:30'}, {'duration': '00:30'}, {'duration': '00:30'}, {'duration': '00:30'}, {'duration': '00:30'}]}, 'order_in_workout': 1}, {'exercise_name': 'Kettlebell Swings', 'set_data': {'sets': [{'weight': 24, 'reps': 20}, {'weight': 24, 'reps': 20}, {'weight': 24, 'reps': 20}]}, 'order_in_workout': 2}]}, 'id': '2fa1d613-4cab-427e-885a-aadec2d47dc7'}]}, {'role': 'user', 'content': [{'type': 'tool_result', 'content': 'You have correctly called this tool.', 'tool_use_id': '2fa1d613-4cab-427e-885a-aadec2d47dc7', 'is_error': False}]}, {'role': 'user', 'content': 'Assistant: You are The TrainSmart Coach. Your role is to collect details about the user\'s workout through structured conversation.\n\nPROCESS FOR EACH RESPONSE:\n1. CHECK MISSING FIELDS\nRead MISSING_FIELDS to identify outstanding workout information\n\n2. DETERMINE NEXT FIELD\nFollow this priority order:\n1. Workout Name (if not provided)\n2. Exercise Details (one exercise at a time)\n   - Exercise Name\n   - Number of Sets\n   - For each set: Reps, Weight, Duration, Distance (as applicable)\n3. Additional Exercises (ask if user wants to add more)\n\n3. FORM RESPONSE\nStructure: [Brief acknowledgment] + [Single question for next priority field]\nExample: "Got it! What would you like to name this workout?"\n\n4. OUTPUT\nCRITICAL: Return ONLY the formed response. No other system information.\n\n5. SUMMARY DISPLAY\nOnce all exercises are recorded, return this exact message:\n\nGreat! Here\'s a summary of your workout:\n\n[Workout Name]\nDescription: [if provided]\n\nExercises:\n1. [Exercise Name]\n   [Set details formatted appropriately]\n2. [Exercise Name]\n   [Set details formatted appropriately]\n[etc.]\n\nDoes this look correct to you?\n\nPERSONALITY:\n- Warm and encouraging but professional\n- Match user\'s technical level\n- Keep responses brief\n- Natural, conversational tone\n\nSPECIAL BEHAVIORS:\n1. When asking about exercises, be specific:\n   "What exercise would you like to add next?"\n\n2. For set data collection:\n   - Ask about one set at a time\n   - Adapt to exercise type (strength vs cardio)\n   - Confirm before moving to next set/exercise\n\n3. Always ask if user wants to add another exercise before showing summary\n\nEXTRACTION_STATE: {extraction_state}\nMISSING_FIELDS: {missing_fields}\n\nPrevious conversation: {messages}\nHuman: {current_message}\nUser: Bi'}], 'model': 'claude-3-sonnet-20240229', 'system': 'Extract workout information from the conversation.\n\nWORKOUT FIELDS:\n\nname:\n- User-provided name for the workout\n- Must be a string\n- Examples:\n  ✓ "Upper Body Day"\n  ✓ "5x5 Squat Session"\n  ✓ "Morning Cardio"\n  ✗ "" (empty when name discussed)\n- Common mistakes:\n  - Using default names when user hasn\'t specified\n  - Including date/time information\n  - Mixing description content into name\n\ndescription:\n- Optional additional context about the workout\n- Can be null if not provided\n- Examples:\n  ✓ "Focus on progressive overload"\n  ✓ "Recovery session"\n  ✗ Including exercise details that belong in set_data\n\nexercises:\n- List of exercises in workout\n- Each exercise must include:\n  1. exercise_name (properly capitalized)\n  2. set_data with array of sets\n  3. order_in_workout (1-based index)\n- Common mistakes:\n  - Incorrect exercise ordering\n  - Missing sets\n  - Improper set data structure\n\nSET DATA FORMATTING RULES:\n\n1. Strength Training:\n   {\n     "weight": number,  // in lbs or kg\n     "reps": number\n   }\n\n2. Cardio/Duration:\n   {\n     "duration": string,  // "MM:SS" format\n     "distance": string   // include units\n   }\n\n3. Mixed/Complex:\n   {\n     "weight": number,\n     "reps": number,\n     "duration": string,\n     "distance": string\n   }\n\nRemember:\n- Maintain exercise order as mentioned in conversation\n- Each set should be individually recorded\n- Convert informal language to structured data\n- Keep original units as specified by user\n- Don\'t assume or add information not in conversation', 'tool_choice': {'type': 'tool', 'name': 'Workout'}, 'tools': [{'name': 'Workout', 'description': '', 'input_schema': {'properties': {'name': {'type': 'string'}, 'description': {'anyOf': [{'type': 'string'}, {'type': 'null'}], 'default': None}, 'exercises': {'items': {'properties': {'exercise_name': {'type': 'string'}, 'set_data': {'properties': {'sets': {'items': {'type': 'object'}, 'type': 'array'}}, 'required': ['sets'], 'type': 'object'}, 'order_in_workout': {'type': 'integer'}}, 'required': ['exercise_name', 'set_data', 'order_in_workout'], 'type': 'object'}, 'type': 'array'}}, 'required': ['name', 'exercises'], 'type': 'object'}}]}}
2024-12-16 15:24:01,240 - httpcore.connection - DEBUG - connect_tcp.started host='api.anthropic.com' port=443 local_address=None timeout=None socket_options=None
2024-12-16 15:24:01,298 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x120c349e0>
2024-12-16 15:24:01,298 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x120c014d0> server_hostname='api.anthropic.com' timeout=None
2024-12-16 15:24:01,330 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x120c356a0>
