2025-03-03 20:00:15,442 - app.services.chains.base_conversation_chain - INFO - Raw chunk from Anthropic: content="'d love to help you with your fitness goals." additional_kwargs={} response_metadata={} id='run-8e53838e-1576-4f39-9727-24c973e0b525'
2025-03-03 20:00:15,445 - app.services.chains.base_conversation_chain - INFO - Chunk type: <class 'langchain_core.messages.ai.AIMessageChunk'>
2025-03-03 20:00:15,632 - app.services.chains.base_conversation_chain - INFO - Raw chunk from Anthropic: content=' To get started, could you share your first an' additional_kwargs={} response_metadata={} id='run-8e53838e-1576-4f39-9727-24c973e0b525'
2025-03-03 20:00:15,632 - app.services.chains.base_conversation_chain - INFO - Chunk type: <class 'langchain_core.messages.ai.AIMessageChunk'>
2025-03-03 20:00:15,825 - app.services.chains.base_conversation_chain - INFO - Raw chunk from Anthropic: content='d last name, and whether you prefer metric (' additional_kwargs={} response_metadata={} id='run-8e53838e-1576-4f39-9727-24c973e0b525'
2025-03-03 20:00:15,825 - app.services.chains.base_conversation_chain - INFO - Chunk type: <class 'langchain_core.messages.ai.AIMessageChunk'>
2025-03-03 20:00:15,915 - app.services.chains.base_conversation_chain - INFO - Raw chunk from Anthropic: content='kg/cm) or imperial (lb/ft' additional_kwargs={} response_metadata={} id='run-8e53838e-1576-4f39-9727-24c973e0b525'
2025-03-03 20:00:15,915 - app.services.chains.base_conversation_chain - INFO - Chunk type: <class 'langchain_core.messages.ai.AIMessageChunk'>
2025-03-03 20:00:16,090 - app.services.chains.base_conversation_chain - INFO - Raw chunk from Anthropic: content=')?' additional_kwargs={} response_metadata={} id='run-8e53838e-1576-4f39-9727-24c973e0b525'
2025-03-03 20:00:16,091 - app.services.chains.base_conversation_chain - INFO - Chunk type: <class 'langchain_core.messages.ai.AIMessageChunk'>
2025-03-03 20:00:16,100 - app.services.chains.base_conversation_chain - INFO - Raw chunk from Anthropic: content='' additional_kwargs={} response_metadata={'stop_reason': 'end_turn', 'stop_sequence': None} id='run-8e53838e-1576-4f39-9727-24c973e0b525' usage_metadata={'input_tokens': 0, 'output_tokens': 47, 'total_tokens': 47, 'input_token_details': {}}
2025-03-03 20:00:16,101 - app.services.chains.base_conversation_chain - INFO - Chunk type: <class 'langchain_core.messages.ai.AIMessageChunk'>
2025-03-03 20:00:16,118 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-03 20:00:16,119 - httpcore.http11 - DEBUG - response_closed.started
2025-03-03 20:00:16,119 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-03 20:00:16,120 - app.services.chains.base_conversation_chain - INFO - 
=== Final Conversation State ===
2025-03-03 20:00:16,120 - app.services.chains.base_conversation_chain - INFO - Total messages: 3
2025-03-03 20:00:16,120 - app.services.chains.base_conversation_chain - INFO - =====================
2025-03-03 20:00:25,209 - app.services.onboarding_service - INFO - Processing message: I’m miles and I use the metric system
2025-03-03 20:00:25,210 - app.services.chains.base_conversation_chain - INFO - 
=== Formatted Messages ===
2025-03-03 20:00:25,210 - app.services.chains.base_conversation_chain - INFO - 
Message 1 (SystemMessage):
2025-03-03 20:00:25,210 - app.services.chains.base_conversation_chain - INFO - Content: You are The TrainSmart Coach. Your role is to gather user information through a structured conversation. Remember to pay attention to special behaviors when forming a reply. 

PROCESS FOR EACH RESPONSE:
1. CHECK MISSING FIELDS
Read MISSING_FIELDS to identify outstanding information

2. DETERMINE NEXT FIELD
Follow this priority order:
1. First/Last Name + Unit system (metric/imperial)
2. Basic Goal
3. Goal Timeframe
4. Specific Goal Numbers
5. Current Abilities
6. Training Preferences
7. Age Group (18-24, 25-34, 35-44, 45-54, 55-64, or 65+)
8. Training Age (years of experience)
9. Injuries



3. FORM RESPONSE
Structure: [Brief acknowledgment] + [Single question for next priority field]
Example: "Thanks, John! What fitness goals would you like to achieve?"

4. OUTPUT
CRITICAL: Return ONLY the formed response. No other text or system information.

5. SUMMARY DISPLAY
Only once all the required information has been collected, return this exact message:

Great! I've got all the information I need. Here's a summary of what we discussed:

Training Profile for [First Name]:
- Goal: [specific goal with timeframe]
- Current Level: [abilities]
- Experience: [training age]
- Preferences: [exercise preferences]
- Health Notes: [injuries/limitations]

Personal Details:
- Name: [First Last]
- Age Group: [range]
- Units: [metric/imperial]

Does this look accurate to you?

PERSONALITY:
- Warm and encouraging but professional
- Match user's technical level
- Keep responses brief
- Natural, conversational tone

SPECIAL BEHAVIORS:
1. Age Group Question
   When asking for age group, always list valid ranges:
   "Which age group do you fall into: 18-24, 25-34, 35-44, 45-54, 55-64, or 65+?"

2. Exercise preferences are different styles of exercise. Running, powerlifting, calisthenics, and yoga are all examples of possible preferences.

3. When asking about metric or imperial units, ask exactly as follows: "Do you prefer metric (kg/cm) or imperial (lb/ft)?"


EXTRACTION_STATE: {extraction_state}
MISSING_FIELDS: {missing_fields}

Previous conversation: {messages}
Human: {current_message}
2025-03-03 20:00:25,210 - app.services.chains.base_conversation_chain - INFO - 
Message 2 (HumanMessage):
2025-03-03 20:00:25,210 - app.services.chains.base_conversation_chain - INFO - Content: Hello! I'm a new user hoping to make a friend and achieve fitness goals with you!
2025-03-03 20:00:25,210 - app.services.chains.base_conversation_chain - INFO - 
Message 3 (HumanMessage):
2025-03-03 20:00:25,210 - app.services.chains.base_conversation_chain - INFO - Content: Hello! I'm a new user hoping to make a friend and achieve fitness goals with you!
2025-03-03 20:00:25,210 - app.services.chains.base_conversation_chain - INFO - 
Message 4 (AIMessage):
2025-03-03 20:00:25,211 - app.services.chains.base_conversation_chain - INFO - Content: Hi there! I'd love to help you with your fitness goals. To get started, could you share your first and last name, and whether you prefer metric (kg/cm) or imperial (lb/ft)?
2025-03-03 20:00:25,211 - app.services.chains.base_conversation_chain - INFO - 
Message 5 (HumanMessage):
2025-03-03 20:00:25,211 - app.services.chains.base_conversation_chain - INFO - Content: I’m miles and I use the metric system
2025-03-03 20:00:25,211 - app.services.chains.base_conversation_chain - INFO - 
Message 6 (HumanMessage):
2025-03-03 20:00:25,211 - app.services.chains.base_conversation_chain - INFO - Content: {current_message}
2025-03-03 20:00:25,212 - app.services.chains.base_conversation_chain - INFO - =====================
2025-03-03 20:00:25,219 - anthropic._base_client - DEBUG - Request options: {'method': 'post', 'url': '/v1/messages', 'files': None, 'json_data': {'max_tokens': 1024, 'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': "Hello! I'm a new user hoping to make a friend and achieve fitness goals with you!"}, {'type': 'text', 'text': "Hello! I'm a new user hoping to make a friend and achieve fitness goals with you!"}]}, {'role': 'assistant', 'content': "Hi there! I'd love to help you with your fitness goals. To get started, could you share your first and last name, and whether you prefer metric (kg/cm) or imperial (lb/ft)?"}, {'role': 'user', 'content': [{'type': 'text', 'text': 'I’m miles and I use the metric system'}, {'type': 'text', 'text': '{current_message}'}]}], 'model': 'claude-3-7-sonnet-20250219', 'stream': True, 'system': 'You are The TrainSmart Coach. Your role is to gather user information through a structured conversation. Remember to pay attention to special behaviors when forming a reply. \n\nPROCESS FOR EACH RESPONSE:\n1. CHECK MISSING FIELDS\nRead MISSING_FIELDS to identify outstanding information\n\n2. DETERMINE NEXT FIELD\nFollow this priority order:\n1. First/Last Name + Unit system (metric/imperial)\n2. Basic Goal\n3. Goal Timeframe\n4. Specific Goal Numbers\n5. Current Abilities\n6. Training Preferences\n7. Age Group (18-24, 25-34, 35-44, 45-54, 55-64, or 65+)\n8. Training Age (years of experience)\n9. Injuries\n\n\n\n3. FORM RESPONSE\nStructure: [Brief acknowledgment] + [Single question for next priority field]\nExample: "Thanks, John! What fitness goals would you like to achieve?"\n\n4. OUTPUT\nCRITICAL: Return ONLY the formed response. No other text or system information.\n\n5. SUMMARY DISPLAY\nOnly once all the required information has been collected, return this exact message:\n\nGreat! I\'ve got all the information I need. Here\'s a summary of what we discussed:\n\nTraining Profile for [First Name]:\n- Goal: [specific goal with timeframe]\n- Current Level: [abilities]\n- Experience: [training age]\n- Preferences: [exercise preferences]\n- Health Notes: [injuries/limitations]\n\nPersonal Details:\n- Name: [First Last]\n- Age Group: [range]\n- Units: [metric/imperial]\n\nDoes this look accurate to you?\n\nPERSONALITY:\n- Warm and encouraging but professional\n- Match user\'s technical level\n- Keep responses brief\n- Natural, conversational tone\n\nSPECIAL BEHAVIORS:\n1. Age Group Question\n   When asking for age group, always list valid ranges:\n   "Which age group do you fall into: 18-24, 25-34, 35-44, 45-54, 55-64, or 65+?"\n\n2. Exercise preferences are different styles of exercise. Running, powerlifting, calisthenics, and yoga are all examples of possible preferences.\n\n3. When asking about metric or imperial units, ask exactly as follows: "Do you prefer metric (kg/cm) or imperial (lb/ft)?"\n\n\nEXTRACTION_STATE: {extraction_state}\nMISSING_FIELDS: {missing_fields}\n\nPrevious conversation: {messages}\nHuman: {current_message}'}}
